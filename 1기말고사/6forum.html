<!DOCTYPE html>
<html>
  
<head>
    <link rel="stylesheet" type="text/css" href="style_layout.css">
    <link rel="stylesheet" type="text/css" href="style_color.css">
    <meta author="ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼ 202121028 ê¹€ë™ìš°">
    <meta charset="utf-8"/>
</head>

<body>
    <div class="background">

        <p class="big_title">ForumğŸ—£ï¸</p>

        <div id="article_list"></div>
        
        <form>
        <div id="bottom_buttons1">
            <input type="button" value=&lt; class="button4-1" onclick="make_table(-1)"><!--ì•í˜ì´ì§€-->
            <input type="text" value = "" class="page_counter1" id="page_counter" disabled><!--í˜ì´ì§€ ìˆ˜ ë³´ì—¬ì¤Œ-->
            <input type="button" value=&gt; class="button4-2" onclick="make_table(1)"><!--ë’·í˜ì´ì§€-->
            
        </div>
        
        <div class="search2">
            <input type="text" id="search_textarea" value="" placeholder="ì—¬ê¸°ì— ê²€ìƒ‰ì–´ ì…ë ¥"><!--ê²€ìƒ‰ì–´ ì…ë ¥ì°½-->
            <a href = "6-3forum-search.html"><input type="button" value="ğŸ”" id="search_button" onclick="search_articles()"></a>
        </div>

        <div id="bottom_buttons2">
            <a href="6-2forum-write.html"><input type="button" value="ê¸€ì“°ê¸°" class="button4" onclick=""></a><!--ê¸€ì“°ê¸°-->
        </div>
        </form>
    </div>
</body>

    <script>

    var output = localStorage.getItem("board");
    var board = JSON.parse(output);//ì´ í˜ì´ì§€ì—ì„œ ì“°ê¸° ìœ„í•´ì„œ localstorageì— ì €ì¥ëœ ë°°ì—´ì„ ë¶ˆëŸ¬ì˜´
      
    //board.sort(date_ascending); // ì˜¤ë¦„ì°¨ìˆœ
    function date_ascending(a, b) {
    var dateA = new Date(a[2]).getTime();
    var dateB = new Date(b[2]).getTime();
    return dateA > dateB ? 1 : -1;};
    //board.sort(date_descending); // ë‚´ë¦¼ì°¨ìˆœ
    function date_descending(a, b) {
    var dateA = new Date(a[2]).getTime();
    var dateB = new Date(b[2]).getTime();
    return dateA < dateB ? 1 : -1;}; 

    board.sort(date_descending);
    apply_change();//boardë¥¼ ì •ë ¬í•˜ê³  ë³€ê²½ ì‚¬í•­ì„ ì €ì¥í•¨
    
    var page_count = 0; //í˜ì´ì§€ ë„˜ê¹€ ì¹´ìš´íŠ¸
    function make_table(num){

        var length = board.length;
        var table = document.getElementById("article_list");
        var final_code = "<table id='article_list' border='0'> <tr> <th>ë²ˆí˜¸</th> <th>ì œëª©</th> <th>ì‘ì„±ì¼</th> <th>ì¢‹ì•„ìš”</th> </tr>";
        
        var articles_in_one_page = 15; //í•œ í˜ì´ì§€ë‹¹ ìµœëŒ€ ê¸€ ìˆ˜
        var full_page_count = Math.ceil(length/articles_in_one_page)-1; //ê¸€ì´ 15ê°œ ê½‰ ì°¨ ìˆëŠ” í˜ì´ì§€ì˜ ìˆ˜, ì†Œìˆ˜ì ì€ ë‚ ë¦¼
        console.log(full_page_count);//ì˜ˆë¥¼ ë“¤ì–´ 31í˜ì´ì§€ë©´ 2ê°€ ë‚˜ì˜´. ì¸ë±ìŠ¤ë¡œëŠ” 0,1,2 ì´ 3í˜ì´ì§€
        
        page_count = page_count + num;// < ë¥¼ ëˆ„ë¥´ë©´ -1ì„ ë”í•˜ê³  > ë¥¼ ëˆ„ë¥´ë©´ 1ì„ ë”í•¨
        console.log(page_count);

        if(page_count < 0){//page_countê°€ -1ì´ ë˜ë©´ ë‹¤ì‹œ 1ì„ ë”í•´ì„œ 0ìœ¼ë¡œ ë§Œë“¤ì–´ì¤Œ. -1ë²ˆì§¸ í˜ì´ì§€ë¼ëŠ”ê±´ ì—†ìœ¼ë‹ˆê¹Œ
            page_count = page_count + 1; 
        }
        else if (page_count >= (full_page_count+1)) {//0,1,2í˜ì´ì§€ ê¹Œì§€ë§Œ ìˆëŠ”ê±´ë° 3í˜ì´ì§€ë¡œ ê°€ë ¤ê³  í•˜ë©´ 1ì„ ë¹¼ì„œ ë‹¤ì‹œ 2ë¡œ ë§Œë“¦
            page_count = page_count - 1;
        }
        console.log(page_count);//0,1,2,3... í˜ì´ì§€

        var start = articles_in_one_page*page_count; //15*0 = 0 ì²˜ìŒ ì¸ë±ìŠ¤
        var end = articles_in_one_page*(page_count+1) // 15*1 = 15 ë ì¸ë±ìŠ¤

        if(page_count == full_page_count){//ifë§ˆì§€ë§‰ í˜ì´ì§€ì— ê°€ë ¤ê³  í•˜ë©´
            end = length;
            //ë ì¸ë±ìŠ¤ë¡œ boardì˜ ê¸¸ì´ë¥¼ ì¤Œ. ì´ë ‡ê²Œ í•˜ëŠ” ì´ìœ ëŠ” ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ 15ê°œì”© ê½‰ì°¨ìˆì§€ ì•Šì•„ ìˆì„ ìˆ˜ ìˆê¸° ë•Œë¬¸.
            //ê·¸ëƒ¥ ë˜ +15í•´ì„œ ë½‘ì•„ë‚´ë©´ ì¸ë±ìŠ¤ ì˜¤ë¥˜ë‚¨
        }
        console.log(start,end);

        var page_counter = document.getElementById("page_counter");
        page_counter.value = (page_count+1)+" / "+(Math.ceil(length/articles_in_one_page));
        //ë°‘ì—ìˆëŠ” í˜ì´ì§€ ìˆ˜ í‘œì‹œê¸°ì— ê°’ ë³´ë‚´ì¤Œ ceilì€ ì†Œìˆ˜ì ê¹Œì§€ ì˜¬ë¦¬ëŠ” í•¨ìˆ˜

        for(var i = start; i< end; i++){
            var code= "<tr> <td>"+(length-i)+"</td> <td onclick='save_article("+i+")'><a href='6-1forum-contents.html'>"+board[i][0]+"</a></td> <td>"+board[i][2]+"</td> <td>"+board[i][3]+"</td></tr>"
            final_code=final_code+code;
        }
        table.innerHTML=final_code;
    }

    function search_articles(){
        var input = document.getElementById("search_textarea");
        var forum_array_1 = [];
        var count = 0;

        for (var i = 0; i < board.length; i++){
            var comp = board[i][0];
            var result = comp.includes(input.value);
            if(result == true) {
                //pass
            }
             else {
                continue;
            }
            
            forum_array_1[count] = [i];
            count++;   
        }
        window.localStorage.setItem("forum_array_1",JSON.stringify(forum_array_1));//localstorageì— ë°°ì—´ì„ ì €ì¥í•˜ëŠ” ë°©ë²•
        //ì¡°ê±´ì— ë§ëŠ” ê¸€ë“¤ì˜ ì¸ë±ìŠ¤ë¥¼ forum_array_1ìœ¼ë¡œ localstorageì— ë°°ì—´í˜•íƒœë¡œ ì €ì¥í•¨
    }

    function save_article(i) {//ê¸€ì„ ëˆŒë €ì„ë•Œ ê·¸ ê¸€ì˜ ì¸ë±ìŠ¤ë¥¼ 6-1forum-contentsì— ë³´ë‚´ì£¼ê¸° ìœ„í•¨. ì´ê±´ 6-2forum-editì—ì„œë„ ì‚¬ìš©í•¨.
        window.localStorage.setItem("forum_value_1",i);
    }

    function apply_change(){//boardì˜ ë³€ê²½ì‚¬í•­ì„ ì €ì¥í•¨
        window.localStorage.setItem("board",JSON.stringify(board));//localstorageì— ë°°ì—´ì„ ì €ì¥í•˜ëŠ” ë°©ë²•
    }
    
    make_table(0);
    </script>
</html>